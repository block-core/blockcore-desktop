{"ast":null,"code":"// m [pubKeys ...] n OP_CHECKMULTISIG\nconst bscript = require('../../script');\n\nconst types = require('../../types');\n\nconst OPS = require('bitcoin-ops');\n\nconst OP_INT_BASE = OPS.OP_RESERVED; // OP_1 - 1\n\nfunction check(script, allowIncomplete) {\n  const chunks = bscript.decompile(script);\n  if (chunks.length < 4) return false;\n  if (chunks[chunks.length - 1] !== OPS.OP_CHECKMULTISIG) return false;\n  if (!types.Number(chunks[0])) return false;\n  if (!types.Number(chunks[chunks.length - 2])) return false;\n  const m = chunks[0] - OP_INT_BASE;\n  const n = chunks[chunks.length - 2] - OP_INT_BASE;\n  if (m <= 0) return false;\n  if (n > 16) return false;\n  if (m > n) return false;\n  if (n !== chunks.length - 3) return false;\n  if (allowIncomplete) return true;\n  const keys = chunks.slice(1, -2);\n  return keys.every(bscript.isCanonicalPubKey);\n}\n\ncheck.toJSON = function () {\n  return 'multi-sig output';\n};\n\nmodule.exports = {\n  check\n};","map":null,"metadata":{},"sourceType":"script"}